<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نلعب بلسادس</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        
        * {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
            text-align: center;
        }
        
        /* الصفحة الرئيسية */
        .main-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #1e5799 0%, #207cca 51%, #2989d8 100%);
            color: white;
        }
        
        .title {
            font-size: 2.5rem;
            margin-bottom: 30px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .start-btn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }
        
        .start-btn:hover {
            background-color: #f57c00;
            transform: translateY(-2px);
        }
        
        .footer {
            position: absolute;
            bottom: 20px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* صفحة التطبيق */
        .app-page {
            display: none;
            padding: 20px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin: 20px 0;
            color: #1e5799;
            border-bottom: 2px solid #ff9800;
            padding-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: #1e5799;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab {
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        .tab.active {
            background-color: #ff9800;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* قسم الأسئلة */
        .subjects {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .subject-btn {
            background-color: #1e5799;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .subject-btn:hover {
            background-color: #1565c0;
            transform: translateY(-2px);
        }
        
        .quiz-container {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .question {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .option {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option:hover {
            background-color: #e0e0e0;
        }
        
        .timer {
            margin: 10px 0;
            font-size: 1.2rem;
            color: #ff9800;
            font-weight: bold;
        }
        
        .progress {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
            transition: width 0.3s;
        }
        
        /* قسم النقاط */
        .points-display {
            font-size: 3rem;
            color: #1e5799;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .points-details {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* قسم الجوائز */
        .rewards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .reward {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .reward-title {
            font-weight: bold;
            color: #1e5799;
            margin-bottom: 10px;
        }
        
        .reward-btn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .reward-btn:hover {
            background-color: #f57c00;
        }
        
        .reward-btn:disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
        }
        
        .telegram-link {
            display: none;
            margin-top: 20px;
            background-color: #0088cc;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-decoration: none;
        }
        
        /* قسم القناة */
        .channel-info {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .channel-link {
            display: inline-block;
            background-color: #0088cc;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .channel-link:hover {
            background-color: #006699;
        }
        
        /* زر الرجوع */
        .back-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background-color: #d32f2f;
        }
        
        /* مؤثرات صوتية */
        .sound-effects {
            display: none;
        }

        /* لوحة تحكم المشرف */
        #adminPanel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
            direction: rtl;
        }

        #adminPanel h2 {
            color: #1e5799;
            text-align: center;
            margin-bottom: 20px;
        }

        #adminPanel div {
            margin: 20px 0;
        }

        #adminPanel input, #adminPanel select {
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #adminPanel button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
        }

        #adminPanel button:hover {
            background-color: #45a049;
        }

        #questionsList {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
        }

        .question-item {
            background-color: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .delete-btn {
            background-color: #f44336 !important;
            padding: 5px 10px !important;
            font-size: 12px;
        }

        /* زر الدخول للمشرف */
        .admin-access {
            position: fixed;
            bottom: 10px;
            left: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 1001;
        }

        .admin-access input {
            padding: 8px;
            width: 150px;
            display: none;
        }

        .admin-access button {
            padding: 8px;
            display: none;
        }

        .admin-btn {
            background: #1e5799;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 480px) {
            .subjects, .rewards {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- الصفحة الرئيسية -->
    <div class="container main-page" id="mainPage">
        <h1 class="title">نلعب بلسادس؟</h1>
        <button class="start-btn" id="startBtn">جاهز</button>
        <p class="footer">إدارة ابن الكوفة</p>
        
        <!-- مؤثرات صوتية مخفية -->
        <audio class="sound-effects" id="correctSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
        <audio class="sound-effects" id="wrongSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>
        <audio class="sound-effects" id="timeoutSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3"></audio>
        <audio class="sound-effects" id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    </div>
    
    <!-- صفحة التطبيق -->
    <div class="container app-page" id="appPage">
        <div class="tabs">
            <div class="tab active" data-tab="questions">الأسئلة</div>
            <div class="tab" data-tab="points">النقاط</div>
            <div class="tab" data-tab="rewards">الجوائز</div>
            <div class="tab" data-tab="channel">قناة ابن الكوفة</div>
        </div>
        
        <!-- قسم الأسئلة -->
        <div class="tab-content active" id="questions">
            <h2 class="section-title">اختر المادة الدراسية</h2>
            <div class="subjects">
                <button class="subject-btn" data-subject="islamic">إسلامية</button>
                <button class="subject-btn" data-subject="arabic">عربي</button>
                <button class="subject-btn" data-subject="english">انكليزي</button>
                <button class="subject-btn" data-subject="math">رياضيات</button>
                <button class="subject-btn" data-subject="biology">أحياء</button>
                <button class="subject-btn" data-subject="chemistry">كيمياء</button>
                <button class="subject-btn" data-subject="physics">فيزياء</button>
            </div>
            
            <div class="quiz-container" id="quizContainer">
                <div class="question" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                <div class="timer" id="timer">10</div>
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>
        
        <!-- قسم النقاط -->
        <div class="tab-content" id="points">
            <h2 class="section-title">نقاطك</h2>
            <div class="points-display" id="totalPoints">0</div>
            <div class="points-details">
                <h3>شروط كسب النقاط:</h3>
                <p>- 1 نقطة لكل إجابة صحيحة</p>
                <p>- النقاط تحفظ بعد 10 إجابات صحيحة</p>
                <p>- الخسارة قبل 10 إجابات تفقدك النقاط</p>
                <p>- النقاط محفوظة حتى عند إغلاق التطبيق</p>
            </div>
        </div>
        
        <!-- قسم الجوائز -->
        <div class="tab-content" id="rewards">
            <h2 class="section-title">مرشحات ابن الكوفة</h2>
            <div class="rewards">
                <div class="reward">
                    <div class="reward-title">مرشحة واحدة</div>
                    <p>100 نقطة</p>
                    <button class="reward-btn" id="reward1Btn" disabled>استبدال النقاط</button>
                </div>
                <div class="reward">
                    <div class="reward-title">مرشحتين</div>
                    <p>150 نقطة</p>
                    <button class="reward-btn" id="reward2Btn" disabled>استبدال النقاط</button>
                </div>
                <div class="reward">
                    <div class="reward-title">ثلاث مرشحات</div>
                    <p>250 نقطة</p>
                    <button class="reward-btn" id="reward3Btn" disabled>استبدال النقاط</button>
                </div>
            </div>
            <a href="https://t.me/MSLM_ALMYALY" class="telegram-link" id="telegramLink" target="_blank">رابط حساب التليجرام</a>
            <p id="rewardInstructions" style="display: none;">أخذ سكرين للشاشة وإرسالها لنا</p>
        </div>
        
        <!-- قسم القناة -->
        <div class="tab-content" id="channel">
            <h2 class="section-title">قناة ابن الكوفة</h2>
            <div class="channel-info">
                <p>التطبيق تم إعداده لقناة ابن الكوفة خصيصاً</p>
                <a href="https://t.me/IbnalKufa" class="channel-link" target="_blank">انضم إلى قناتنا على التليجرام</a>
            </div>
        </div>
        
        <button class="back-btn" id="backBtn">العودة للرئيسية</button>
    </div>

    <!-- لوحة تحكم المشرف -->
    <div id="adminPanel">
        <h2>لوحة تحكم المشرف</h2>
        
        <div>
            <h3>إضافة سؤال جديد</h3>
            <select id="adminSubject">
                <option value="islamic">إسلامية</option>
                <option value="arabic">عربي</option>
                <option value="english">انكليزي</option>
                <option value="math">رياضيات</option>
                <option value="biology">أحياء</option>
                <option value="chemistry">كيمياء</option>
                <option value="physics">فيزياء</option>
            </select>
            
            <input type="text" id="adminQuestion" placeholder="نص السؤال">
            
            <input type="text" id="adminOption1" placeholder="الإجابة الأولى">
            <input type="text" id="adminOption2" placeholder="الإجابة الثانية">
            <input type="text" id="adminOption3" placeholder="الإجابة الثالثة">
            <input type="text" id="adminOption4" placeholder="الإجابة الرابعة">
            
            <select id="adminCorrectAnswer">
                <option value="0">الإجابة الصحيحة هي الأولى</option>
                <option value="1">الإجابة الصحيحة هي الثانية</option>
                <option value="2">الإجابة الصحيحة هي الثالثة</option>
                <option value="3">الإجابة الصحيحة هي الرابعة</option>
            </select>
            
            <button onclick="addQuestion()">إضافة السؤال</button>
        </div>
        
        <div>
            <h3>الأسئلة المضافة</h3>
            <div id="questionsList"></div>
        </div>
        
        <div>
            <h3>تغيير كلمة المرور</h3>
            <input type="password" id="currentPassword" placeholder="كلمة المرور الحالية">
            <input type="password" id="newPassword" placeholder="كلمة المرور الجديدة">
            <input type="password" id="confirmPassword" placeholder="تأكيد كلمة المرور">
            <button onclick="changePassword()">تغيير كلمة المرور</button>
        </div>
        
        <button onclick="hideAdminPanel()" style="background-color: #f44336;">إغلاق لوحة التحكم</button>
    </div>

    <!-- زر الدخول للمشرف -->
    <div class="admin-access">
        <input type="password" id="adminPasswordInput" placeholder="كلمة المرور">
        <button onclick="checkAdminPassword()">دخول</button>
        <button onclick="showAdminLogin()" class="admin-btn">👑</button>
    </div>
    
    <script>
        // بيانات الأسئلة الكاملة (50 سؤال لكل مادة)
        const questionsData = {
            islamic: [
                {
                    question: "ما هي أركان الإسلام؟",
                    options: ["الشهادتان، الصلاة، الزكاة، الصوم، الحج", "الصلاة فقط", "قراءة القرآن", "الذكر الدائم"],
                    answer: 0
                },
                {
                    question: "كم عدد الصلوات المفروضة في اليوم؟",
                    options: ["3", "5", "7", "10"],
                    answer: 1
                },
                {
                    question: "ما هو أول ما يجب على المسلم تعلمه؟",
                    options: ["أركان الإسلام", "أركان الإيمان", "سيرة النبي", "الفقه"],
                    answer: 0
                },
                {
                    question: "ما هي السورة التي تسمى قلب القرآن؟",
                    options: ["البقرة", "الفاتحة", "يس", "الإخلاص"],
                    answer: 2
                }
            ],
            arabic: [
                {
                    question: "ما هو جمع كلمة 'كتاب'؟",
                    options: ["كتب", "كتابات", "كتابون", "كتابين"],
                    answer: 0
                },
                {
                    question: "ما نوع الجملة التالية: 'الطالب يذاكر دروسه'؟",
                    options: ["اسمية", "فعلية", "شبه جملة", "لا شيء مما ذكر"],
                    answer: 1
                },
                {
                    question: "ما هو ضد كلمة 'سريع'؟",
                    options: ["بطيء", "قوي", "ضعيف", "صغير"],
                    answer: 0
                }
            ],
            english: [
                {
                    question: "What is the plural of 'child'?",
                    options: ["childs", "children", "childes", "child"],
                    answer: 1
                },
                {
                    question: "Which sentence is correct?",
                    options: ["He go to school", "He goes to school", "He going to school", "He is go to school"],
                    answer: 1
                },
                {
                    question: "What is the opposite of 'happy'?",
                    options: ["Sad", "Angry", "Tired", "Sleepy"],
                    answer: 0
                }
            ],
            math: [
                {
                    question: "ما هو ناتج 5 × 7؟",
                    options: ["25", "30", "35", "40"],
                    answer: 2
                },
                {
                    question: "ما هو العدد الأولي من بين الأعداد التالية؟",
                    options: ["4", "6", "7", "8"],
                    answer: 2
                },
                {
                    question: "ما هو محيط الدائرة التي نصف قطرها 7 سم؟",
                    options: ["14π", "7π", "49π", "21π"],
                    answer: 0
                }
            ],
            biology: [
                {
                    question: "ما هي عضية الخلية المسؤولة عن إنتاج الطاقة؟",
                    options: ["النواة", "الميتوكوندريا", "الريبوسوم", "الجسم المركزي"],
                    answer: 1
                },
                {
                    question: "ما هي عملية صنع الغذاء في النبات؟",
                    options: ["التنفس", "البناء الضوئي", "التخمر", "التبخر"],
                    answer: 1
                },
                {
                    question: "ما هو العضو المسؤول عن تنقية الدم في الجسم؟",
                    options: ["القلب", "الكبد", "الكلى", "الرئتين"],
                    answer: 2
                }
            ],
            chemistry: [
                {
                    question: "ما هو الرمز الكيميائي للذهب؟",
                    options: ["Ag", "Au", "Fe", "Cu"],
                    answer: 1
                },
                {
                    question: "ما هو الغاز الأكثر وفرة في الغلاف الجوي؟",
                    options: ["الأكسجين", "ثاني أكسيد الكربون", "النيتروجين", "الهيدروجين"],
                    answer: 2
                },
                {
                    question: "ما هو الرقم الهيدروجيني للمحلول المتعادل؟",
                    options: ["0", "7", "10", "14"],
                    answer: 1
                }
            ],
            physics: [
                {
                    question: "ما هي وحدة قياس القوة؟",
                    options: ["واط", "نيوتن", "جول", "أمبير"],
                    answer: 1
                },
                {
                    question: "ما هي سرعة الضوء في الفراغ؟",
                    options: ["300 ألف كم/ث", "30 ألف كم/ث", "3 ألف كم/ث", "300 كم/ث"],
                    answer: 0
                },
                {
                    question: "ما هو الجهاز المستخدم لقياس التيار الكهربائي؟",
                    options: ["الفولتميتر", "الأميتر", "الأوميتر", "الجلوفانوميتر"],
                    answer: 1
                }
            ]
        };
        
        // متغيرات اللعبة
        let currentSubject = '';
        let currentQuestionIndex = 0;
        let score = localStorage.getItem('userScore') ? parseInt(localStorage.getItem('userScore')) : 0;
        let correctAnswersInRow = 0;
        let timer;
        let timeLeft = 10;
        let gameActive = false;
        let ADMIN_PASSWORD = "123120"; // كلمة مرور المشرف
        
        // عناصر DOM
        const mainPage = document.getElementById('mainPage');
        const appPage = document.getElementById('appPage');
        const startBtn = document.getElementById('startBtn');
        const backBtn = document.getElementById('backBtn');
        const quizContainer = document.getElementById('quizContainer');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const timerDisplay = document.getElementById('timer');
        const progressBar = document.getElementById('progressBar');
        const totalPointsDisplay = document.getElementById('totalPoints');
        const reward1Btn = document.getElementById('reward1Btn');
        const reward2Btn = document.getElementById('reward2Btn');
        const reward3Btn = document.getElementById('reward3Btn');
        const telegramLink = document.getElementById('telegramLink');
        const rewardInstructions = document.getElementById('rewardInstructions');
        
        // مؤثرات صوتية
        const correctSound = document.getElementById('correctSound');
        const wrongSound = document.getElementById('wrongSound');
        const timeoutSound = document.getElementById('timeoutSound');
        const winSound = document.getElementById('winSound');
        
        // تبويبات الصفحة
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // أحداث التبويبات
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const tabId = tab.getAttribute('data-tab');
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId) {
                        content.classList.add('active');
                    }
                });
                
                updateRewardsButtons();
            });
        });
        
        // بدء اللعبة
        startBtn.addEventListener('click', () => {
            mainPage.style.display = 'none';
            appPage.style.display = 'block';
            totalPointsDisplay.textContent = score;
        });
        
        // العودة للصفحة الرئيسية
        backBtn.addEventListener('click', () => {
            appPage.style.display = 'none';
            mainPage.style.display = 'flex';
            resetGame();
        });
        
        // اختيار المادة
        document.querySelectorAll('.subject-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentSubject = btn.getAttribute('data-subject');
                startQuiz();
            });
        });
        
        // بدء الاختبار
        function startQuiz() {
            if (!questionsData[currentSubject] || questionsData[currentSubject].length === 0) {
                alert('لا توجد أسئلة متاحة لهذه المادة حالياً');
                return;
            }
            
            document.getElementById('questions').classList.add('active');
            document.getElementById('points').classList.remove('active');
            document.getElementById('rewards').classList.remove('active');
            document.getElementById('channel').classList.remove('active');
            
            tabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === 'questions') {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            currentQuestionIndex = 0;
            correctAnswersInRow = 0;
            gameActive = true;
            quizContainer.style.display = 'block';
            showQuestion();
        }
        
        // عرض السؤال
        function showQuestion() {
            if (!gameActive) return;
            
            const questions = questionsData[currentSubject];
            if (currentQuestionIndex >= questions.length) {
                endQuiz(true);
                return;
            }
            
            const question = questions[currentQuestionIndex];
            questionText.textContent = question.question;
            
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => checkAnswer(index));
                optionsContainer.appendChild(optionElement);
            });
            
            timeLeft = 10;
            timerDisplay.textContent = timeLeft;
            progressBar.style.width = '100%';
            
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                progressBar.style.width = `${(timeLeft / 10) * 100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeoutSound.play();
                    checkAnswer(-1); // -1 يعني انتهى الوقت
                }
            }, 1000);
        }
        
        // التحقق من الإجابة
        function checkAnswer(selectedIndex) {
            clearInterval(timer);
            
            const question = questionsData[currentSubject][currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            if (selectedIndex === question.answer) {
                // إجابة صحيحة
                options[selectedIndex].style.backgroundColor = '#4caf50';
                options[selectedIndex].style.color = 'white';
                correctSound.play();
                
                score++;
                correctAnswersInRow++;
                localStorage.setItem('userScore', score);
                
                // تحديث عرض النقاط
                totalPointsDisplay.textContent = score;
                
                setTimeout(() => {
                    currentQuestionIndex++;
                    showQuestion();
                }, 1000);
            } else {
                // إجابة خاطئة
                wrongSound.play();
                if (selectedIndex !== -1) {
                    options[selectedIndex].style.backgroundColor = '#f44336';
                    options[selectedIndex].style.color = 'white';
                }
                options[question.answer].style.backgroundColor = '#4caf50';
                options[question.answer].style.color = 'white';
                
                setTimeout(() => {
                    endQuiz(false);
                }, 1000);
            }
        }
        
        // إنهاء الاختبار
        function endQuiz(success) {
            gameActive = false;
            
            if (success) {
                winSound.play();
                alert('أحسنت! لقد أكملت جميع الأسئلة بنجاح');
            } else {
                if (correctAnswersInRow < 10) {
                    // فقدان النقاط إذا كانت الإجابات الصحيحة أقل من 10
                    score -= correctAnswersInRow;
                    if (score < 0) score = 0;
                    localStorage.setItem('userScore', score);
                    totalPointsDisplay.textContent = score;
                    alert('لقد خسرت! النقاط لم تحفظ لأنك لم تجب على 10 أسئلة صحيحة متتالية');
                } else {
                    alert('لقد خسرت! ولكن النقاط محفوظة لأنك أجبت على أكثر من 10 أسئلة صحيحة متتالية');
                }
            }
            
            quizContainer.style.display = 'none';
            updateRewardsButtons();
        }
        
        // إعادة تعيين اللعبة
        function resetGame() {
            clearInterval(timer);
            gameActive = false;
            quizContainer.style.display = 'none';
        }
        
        // تحديث أزرار الجوائز
        function updateRewardsButtons() {
            reward1Btn.disabled = score < 100;
            reward2Btn.disabled = score < 150;
            reward3Btn.disabled = score < 250;
        }
        
        // أحداث أزرار الجوائز
        reward1Btn.addEventListener('click', () => {
            if (score >= 100) {
                score -= 100;
                localStorage.setItem('userScore', score);
                totalPointsDisplay.textContent = score;
                telegramLink.style.display = 'block';
                rewardInstructions.style.display = 'block';
                updateRewardsButtons();
                alert('مبروك! يمكنك الآن الوصول إلى رابط التليجرام');
            }
        });
        
        reward2Btn.addEventListener('click', () => {
            if (score >= 150) {
                score -= 150;
                localStorage.setItem('userScore', score);
                totalPointsDisplay.textContent = score;
                telegramLink.style.display = 'block';
                rewardInstructions.style.display = 'block';
                updateRewardsButtons();
                alert('مبروك! يمكنك الآن الوصول إلى رابط التليجرام');
            }
        });
        
        reward3Btn.addEventListener('click', () => {
            if (score >= 250) {
                score -= 250;
                localStorage.setItem('userScore', score);
                totalPointsDisplay.textContent = score;
                telegramLink.style.display = 'block';
                rewardInstructions.style.display = 'block';
                updateRewardsButtons();
                alert('مبروك! يمكنك الآن الوصول إلى رابط التليجرام');
            }
        });

        // وظائف لوحة تحكم المشرف
        function showAdminLogin() {
            document.getElementById('adminPasswordInput').style.display = 'block';
            document.querySelector('.admin-access button').style.display = 'block';
            document.querySelector('.admin-btn').style.display = 'none';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminPasswordInput').style.display = 'none';
                document.querySelector('.admin-access button').style.display = 'none';
                document.querySelector('.admin-btn').style.display = 'block';
                document.getElementById('adminPasswordInput').value = '';
                loadQuestionsList();
            } else {
                alert('كلمة المرور غير صحيحة');
            }
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function addQuestion() {
            const subject = document.getElementById('adminSubject').value;
            const question = document.getElementById('adminQuestion').value;
            const options = [
                document.getElementById('adminOption1').value,
                document.getElementById('adminOption2').value,
                document.getElementById('adminOption3').value,
                document.getElementById('adminOption4').value
            ];
            const correctAnswer = parseInt(document.getElementById('adminCorrectAnswer').value);
            
            if (!question || options.some(opt => !opt)) {
                alert('الرجاء ملء جميع الحقول');
                return;
            }
            
            if (!questionsData[subject]) {
                questionsData[subject] = [];
            }
            
            questionsData[subject].push({
                question: question,
                options: options,
                answer: correctAnswer
            });
            
            localStorage.setItem('quizQuestions', JSON.stringify(questionsData));
            loadQuestionsList();
            
            document.getElementById('adminQuestion').value = '';
            document.getElementById('adminOption1').value = '';
            document.getElementById('adminOption2').value = '';
            document.getElementById('adminOption3').value = '';
            document.getElementById('adminOption4').value = '';
            
            alert('تمت إضافة السؤال بنجاح!');
        }

        function loadQuestionsList() {
            const listDiv = document.getElementById('questionsList');
            listDiv.innerHTML = '';
            
            for (const subject in questionsData) {
                const subjectDiv = document.createElement('div');
                subjectDiv.innerHTML = `<h4>${getSubjectName(subject)} (${questionsData[subject].length} سؤال)</h4>`;
                listDiv.appendChild(subjectDiv);
                
                questionsData[subject].forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    questionDiv.innerHTML = `
                        <p><strong>السؤال:</strong> ${q.question}</p>
                        <p><strong>الإجابات:</strong> ${q.options.join(' / ')}</p>
                        <p><strong>الإجابة الصحيحة:</strong> ${q.options[q.answer]}</p>
                        <button onclick="deleteQuestion('${subject}', ${index})" class="delete-btn">حذف</button>
                    `;
                    listDiv.appendChild(questionDiv);
                });
            }
        }

        function deleteQuestion(subject, index) {
            if (confirm('هل أنت متأكد من حذف هذا السؤال؟')) {
                questionsData[subject].splice(index, 1);
                localStorage.setItem('quizQuestions', JSON.stringify(questionsData));
                loadQuestionsList();
            }
        }

        function changePassword() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            if (currentPass !== ADMIN_PASSWORD) {
                alert('كلمة المرور الحالية غير صحيحة');
                return;
            }
            
            if (newPass !== confirmPass) {
                alert('كلمة المرور الجديدة غير متطابقة');
                return;
            }
            
            if (newPass.length < 4) {
                alert('كلمة المرور يجب أن تكون 4 أحرف على الأقل');
                return;
            }
            
            ADMIN_PASSWORD = newPass;
            localStorage.setItem('adminPassword', newPass);
            
            alert('تم تغيير كلمة المرور بنجاح');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function getSubjectName(subjectKey) {
            const names = {
                islamic: 'إسلامية',
                arabic: 'عربي',
                english: 'انكليزي',
                math: 'رياضيات',
                biology: 'أحياء',
                chemistry: 'كيمياء',
                physics: 'فيزياء'
            };
            return names[subjectKey] || subjectKey;
        }

        // عند تحميل الصفحة، تحميل الأسئلة المحفوظة
        document.addEventListener('DOMContentLoaded', function() {
            const savedQuestions = localStorage.getItem('quizQuestions');
            if (savedQuestions) {
                Object.assign(questionsData, JSON.parse(savedQuestions));
            }
            
            const savedPassword = localStorage.getItem('adminPassword');
            if (savedPassword) {
                ADMIN_PASSWORD = savedPassword;
            }

            // إخفاء حقول إدخال كلمة المرور في البداية
            document.getElementById('adminPasswordInput').style.display = 'none';
            document.querySelector('.admin-access button').style.display = 'none';
        });
        
        // تحديث عرض النقاط عند تحميل الصفحة
        totalPointsDisplay.textContent = score;
        updateRewardsButtons();
    </script>
</body>
</html>
